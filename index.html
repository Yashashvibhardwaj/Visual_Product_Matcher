<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
  <title>Visual Product Matcher â€“ StyleSense</title>
  
  <!-- Tailwind (CDN) with dark mode enabled -->
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          animation: {
            'float': 'float 6s ease-in-out infinite',
            'gradient': 'gradient 15s ease infinite',
          },
          keyframes: {
            float: {
              '0%, 100%': { transform: 'translateY(0)' },
              '50%': { transform: 'translateY(-10px)' },
            },
            gradient: {
              '0%, 100%': {
                'background-size': '200% 200%',
                'background-position': 'left center'
              },
              '50%': {
                'background-size': '200% 200%',
                'background-position': 'right center'
              }
            }
          }
        }
      }
    }
  </script>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React 18 + ReactDOM 18 + Babel for JSX in-browser -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
    
    * {
      font-family: 'Inter', sans-serif;
      box-sizing: border-box;
    }
    
    .animate-in {
      animation: fadeIn 0.4s ease both;
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: none;
      }
    }
    
    .glass-effect {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .dark .glass-effect {
      background: rgba(0, 0, 0, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .gradient-border {
      position: relative;
      border: double 2px transparent;
      background-image: linear-gradient(white, white), 
                        linear-gradient(to right, #0ea5e9, #ec4899, #f59e0b);
      background-origin: border-box;
      background-clip: padding-box, border-box;
    }
    
    .dark .gradient-border {
      background-image: linear-gradient(#1f2937, #1f2937), 
                        linear-gradient(to right, #0ea5e9, #ec4899, #f59e0b);
    }
    
    .product-card {
      transition: all 0.3s ease;
    }
    
    .product-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    
    .shine-effect {
      position: relative;
      overflow: hidden;
    }
    
    .shine-effect::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: rgba(255, 255, 255, 0.1);
      transform: rotate(45deg);
      transition: all 0.6s ease;
      opacity: 0;
    }
    
    .shine-effect:hover::before {
      opacity: 1;
      animation: shine 1.5s forwards;
    }
    
    @keyframes shine {
      0% {
        transform: rotate(45deg) translate(-10%, -10%);
      }
      100% {
        transform: rotate(45deg) translate(100%, 100%);
      }
    }
    
    /* Custom slider styles */
    input[type="range"] {
      -webkit-appearance: none;
      height: 6px;
      width: 100%;
      border-radius: 5px;
      background: linear-gradient(to right, #0ea5e9, #ec4899, #f59e0b);
      outline: none;
    }
    
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #fff;
      border: 2px solid #ec4899;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }
    
    input[type="range"]::-moz-range-thumb {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #fff;
      border: 2px solid #ec4899;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }
    
    /* Custom checkbox */
    .filter-checkbox:checked {
      background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
      background-color: #ec4899;
      border-color: #ec4899;
    }

    /* Mobile optimizations */
    @media (max-width: 640px) {
      .mobile-scroll {
        overflow-x: auto;
        white-space: nowrap;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
      }
      
      .mobile-scroll::-webkit-scrollbar {
        display: none;
      }
      
      .mobile-tap-target {
        min-height: 44px;
        min-width: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .mobile-text-lg {
        font-size: 1.125rem;
        line-height: 1.75rem;
      }
      
      .mobile-padding {
        padding-left: 1rem;
        padding-right: 1rem;
      }
    }

    /* Prevent horizontal scroll on mobile */
    html, body {
      overflow-x: hidden;
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-sky-50 via-rose-50 to-amber-50 text-gray-900 dark:bg-gradient-to-br dark:from-gray-900 dark:via-gray-800 dark:to-gray-900">
  <div id="root" class="h-full"></div>

  <script>
    window.BACKEND_URL = "http://localhost:8000";
  </script>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    function App() {
      const [file, setFile] = useState(null);
      const [imageUrl, setImageUrl] = useState("");
      const [preview, setPreview] = useState("");
      const [minScore, setMinScore] = useState(0.6);
      const [perPage, setPerPage] = useState(12);
      const [sort, setSort] = useState("score_desc");
      const [page, setPage] = useState(1);
      const [results, setResults] = useState([]);
      const [loading, setLoading] = useState(false);
      const [err, setErr] = useState("");
      const [toast, setToast] = useState("");
      const [dark, setDark] = useState(false);
      const [activeTab, setActiveTab] = useState("upload");
      const [searchMode, setSearchMode] = useState("image"); // "image" or "text"
      const [searchQuery, setSearchQuery] = useState("");
      const [priceRange, setPriceRange] = useState([0, 200]);
      const [selectedCategories, setSelectedCategories] = useState([]);
      const [selectedBrands, setSelectedBrands] = useState([]);
      const [showFilters, setShowFilters] = useState(false);
      const [isMobile, setIsMobile] = useState(window.innerWidth < 768);
      const [showImageModal, setShowImageModal] = useState(false);

      // Handle window resize for mobile detection
      useEffect(() => {
        const handleResize = () => {
          setIsMobile(window.innerWidth < 768);
        };
        
        window.addEventListener('resize', handleResize);
        return () => window.removeEventListener('resize', handleResize);
      }, []);

      // Sample data for filters
      const categories = ["Clothing", "Footwear", "Accessories", "Bags", "Jewelry", "Watches"];
      const brands = ["Nike", "Adidas", "Zara", "H&M", "Gucci", "Prada", "Levi's", "Uniqlo"];

      // Theme persistence
      useEffect(() => {
        const saved = localStorage.getItem("theme");
        const isDark = saved === "dark" || (!saved && window.matchMedia('(prefers-color-scheme: dark)').matches);
        setDark(isDark);
        if (isDark) {
          document.documentElement.classList.add("dark");
        } else {
          document.documentElement.classList.remove("dark");
        }
      }, []);

      useEffect(
        () => () => {
          if (preview && preview.startsWith("blob:"))
            URL.revokeObjectURL(preview);
        },
        [preview]
      );

      function onPick(e) {
        const f = e.target.files?.[0] || null;
        setFile(f);
        setImageUrl("");
        setErr("");
        setPreview(f ? URL.createObjectURL(f) : "");
      }

      function onUrlChange(v) {
        setImageUrl(v);
        setErr("");
        if (v) {
          setFile(null);
          setPreview(v);
        } else if (!file) {
          setPreview("");
        }
      }

      function toggleDark() {
        const next = !dark;
        setDark(next);
        if (next) {
          document.documentElement.classList.add("dark");
          localStorage.setItem("theme", "dark");
        } else {
          document.documentElement.classList.remove("dark");
          localStorage.setItem("theme", "light");
        }
      }

      function showToast(msg) {
        setToast(msg);
        setTimeout(() => setToast(""), 2500);
      }

      async function onSearch() {
        // Text search mode
        if (searchMode === "text" && !searchQuery.trim()) {
          setErr("Please enter a search query.");
          showToast("Enter a search query");
          return;
        }
        
        // Image search mode
        if (searchMode === "image" && !file && !imageUrl) {
          setErr("Please upload a file or paste an image URL.");
          showToast("Provide a file or image URL");
          return;
        }
        
        setLoading(true);
        setErr("");
        setResults([]);
        setPage(1);
        try {
          const api = window.BACKEND_URL?.trim();
          if (api) {
            const fd = new FormData();
            if (searchMode === "image") {
              if (file) fd.append("file", file);
              if (imageUrl) fd.append("image_url", imageUrl);
            } else {
              fd.append("query", searchQuery);
            }
            fd.append("min_score", String(minScore));
            fd.append("top_k", "60");
            
            // Add filters if they exist
            if (selectedCategories.length) {
              fd.append("categories", JSON.stringify(selectedCategories));
            }
            if (selectedBrands.length) {
              fd.append("brands", JSON.stringify(selectedBrands));
            }
            if (priceRange[0] > 0 || priceRange[1] < 200) {
              fd.append("min_price", String(priceRange[0]));
              fd.append("max_price", String(priceRange[1]));
            }
            
            const endpoint = searchMode === "image" ? "/match" : "/search_text";
            const res = await fetch(api.replace(/\/$/, "") + endpoint, {
              method: "POST",
              body: fd,
            });
            if (!res.ok) {
              throw new Error(
                (await res.text()) || `Request failed (${res.status})`
              );
            }
            const data = await res.json();
            setResults(Array.isArray(data.matches) ? data.matches : []);
            showToast("Search complete!");
          } else {
            // Demo mode
            const cats = ["Clothing", "Footwear", "Accessories", "Bags"];
            const imgs = [
              "https://images.unsplash.com/photo-1512436991641-6745cdb1723f",
              "https://images.unsplash.com/photo-1542291026-7eec264c27ff",
              "https://images.unsplash.com/photo-1517841905240-472988babdf9",
              "https://images.unsplash.com/photo-1528701800489-20be3c2ea5a2",
            ];
            const mock = Array.from({ length: 20 }).map((_, i) => ({
              id: "demo-" + i,
              name: ["Red Tee", "Blue Sneakers", "Classic Watch", "Leather Bag"][i % 4],
              category: cats[i % cats.length],
              image_url: imgs[i % imgs.length] + "?auto=format&fit=crop&w=600&q=60",
              score: +(0.95 - i * 0.02).toFixed(2),
              price: "$" + (19.99 + i * 5).toFixed(2),
              brand: ["Nike", "Adidas", "Zara", "H&M"][i % 4]
            }));
            setResults(mock);
            showToast("Demo results (set BACKEND_URL for real API)");
          }
        } catch (e) {
          const msg = e?.message || "Something went wrong";
          setErr(msg);
          showToast("Error: " + msg);
        } finally {
          setLoading(false);
        }
      }

      const filteredSorted = useMemo(() => {
        let f = results.filter((r) => (r?.score ?? 0) >= minScore);
        
        // Apply category filter
        if (selectedCategories.length > 0) {
          f = f.filter(item => selectedCategories.includes(item.category));
        }
        
        // Apply brand filter
        if (selectedBrands.length > 0) {
          f = f.filter(item => selectedBrands.includes(item.brand));
        }
        
        // Apply price filter (works for both string "$29.99" and number 29.99)
      f = f.filter(item => {
      let price = item.price;
      if (typeof price === "string") {
        price = parseFloat(price.replace('$', ''));
      }
      return price >= priceRange[0] && price <= priceRange[1];
      });

        
        return [...f].sort((a, b) =>
          sort === "score_desc" ? b.score - a.score : a.score - b.score
        );
      }, [results, minScore, sort, selectedCategories, selectedBrands, priceRange]);

      const total = filteredSorted.length;
      const totalPages = Math.max(1, Math.ceil(total / perPage));
      const start = (page - 1) * perPage;
      const end = start + perPage;
      const pageItems = filteredSorted.slice(start, end);

      function useExample(u) {
        onUrlChange(u);
        setActiveTab("url");
      }

      // Handle threshold input change
      const handleThresholdChange = (e) => {
        const value = parseFloat(e.target.value);
        // Validate the input is between 0 and 1
        if (!isNaN(value) && value >= 0 && value <= 1) {
          setMinScore(value);
        }
      };

      // Handle price range change
      const handlePriceChange = (e, index) => {
        const newValue = parseInt(e.target.value);
        const newRange = [...priceRange];
        newRange[index] = newValue;
        setPriceRange(newRange);
      };

      // Toggle category selection
      const toggleCategory = (category) => {
        setSelectedCategories(prev => 
          prev.includes(category) 
            ? prev.filter(c => c !== category)
            : [...prev, category]
        );
      };

      // Toggle brand selection
      const toggleBrand = (brand) => {
        setSelectedBrands(prev => 
          prev.includes(brand) 
            ? prev.filter(b => b !== brand)
            : [...prev, brand]
        );
      };

      // Clear all filters
      const clearFilters = () => {
        setSelectedCategories([]);
        setSelectedBrands([]);
        setPriceRange([0, 200]);
      };

      return (
        <div className="min-h-screen text-gray-900 dark:bg-gray-900 dark:text-gray-100">
          {/* Animated background elements */}
          <div className="pointer-events-none fixed inset-0 -z-10 overflow-hidden">
            <div className="absolute -top-16 -left-16 h-64 w-64 rounded-full bg-sky-300/30 blur-3xl dark:bg-sky-900/30 animate-float" style={{animationDelay: '0s'}} />
            <div className="absolute top-24 -right-10 h-64 w-64 rounded-full bg-rose-300/30 blur-3xl dark:bg-rose-900/30 animate-float" style={{animationDelay: '1s'}} />
            <div className="absolute bottom-0 left-1/4 h-72 w-72 rounded-full bg-amber-200/30 blur-3xl dark:bg-amber-900/30 animate-float" style={{animationDelay: '2s'}} />
            <div className="absolute top-1/3 right-1/4 h-56 w-56 rounded-full bg-purple-300/20 blur-3xl dark:bg-purple-900/20 animate-float" style={{animationDelay: '1.5s'}} />
          </div>

          {/* Toast */}
          {toast && (
            <div className="fixed top-4 left-1/2 -translate-x-1/2 z-50 glass-effect text-gray-800 dark:text-gray-200 px-6 py-3 rounded-full shadow-lg animate-in flex items-center gap-2 max-w-[90vw]">
              <i className="fas fa-info-circle text-sky-500"></i>
              <span className="truncate">{toast}</span>
            </div>
          )}

          {/* Image Modal */}
          {showImageModal && preview && (
            <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-4" onClick={() => setShowImageModal(false)}>
              <div className="max-w-4xl max-h-full" onClick={e => e.stopPropagation()}>
                <img 
                  src={preview} 
                  alt="Preview" 
                  className="max-w-full max-h-full object-contain rounded-lg"
                />
                <button 
                  className="absolute top-4 right-4 text-white bg-black/50 rounded-full p-2 hover:bg-black/70"
                  onClick={() => setShowImageModal(false)}
                >
                  <i className="fas fa-times"></i>
                </button>
              </div>
            </div>
          )}

          {/* Header */}
          <header className="sticky top-0 z-10 glass-effect border-b border-white/20">
            <div className="mx-auto max-w-7xl px-4 py-3 flex items-center justify-between">
              <div className="flex items-center gap-3">
                <div className="p-2 bg-gradient-to-r from-sky-600 via-rose-600 to-amber-600 rounded-xl text-white">
                  <i className="fas fa-camera-retro text-lg"></i>
                </div>
                <h1 className="text-xl sm:text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-sky-600 via-rose-600 to-amber-600">
                  StyleSense
                </h1>
                <span className="hidden sm:inline text-xs bg-sky-100 text-sky-700 dark:bg-sky-700/30 dark:text-sky-300 px-2 py-1 rounded-full">
                  Visual Product Matcher
                </span>
              </div>
              <div className="flex items-center gap-3">
                <button
                  onClick={toggleDark}
                  className="p-2 rounded-full glass-effect hover:bg-white/20 transition-all duration-300 mobile-tap-target"
                  aria-label="Toggle dark mode"
                >
                  {dark ? <i className="fas fa-moon text-amber-400"></i> : <i className="fas fa-sun text-amber-500"></i>}
                </button>
                <a
                  className="text-sm px-4 py-2 rounded-full glass-effect hover:bg-white/20 transition-all duration-300 flex items-center gap-2 mobile-tap-target"
                  href="#"
                  target="_blank"
                  rel="noreferrer"
                >
                  <i className="fab fa-github"></i>
                  <span className="hidden sm:inline">GitHub</span>
                </a>
              </div>
            </div>
          </header>

          {/* Main */}
          <main className="mx-auto max-w-7xl px-4 py-8 grid gap-8 mobile-padding">
            {/* Hero Section */}
            <section className="text-center max-w-3xl mx-auto">
              <h2 className="text-3xl sm:text-4xl md:text-5xl font-bold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-sky-600 via-rose-600 to-amber-600">
                Discover Similar Products
              </h2>
              <p className="text-base sm:text-lg text-gray-600 dark:text-gray-300 mb-8">
                Upload an image or paste a URL to find visually similar products from our catalog. 
                Perfect for fashion inspiration and shopping.
              </p>
            </section>

            {/* Controls Card */}
            <section className="rounded-3xl overflow-hidden gradient-border p-1">
              <div className="rounded-3xl bg-white/80 dark:bg-gray-800/90 p-4 sm:p-6 shadow-xl">
                {/* Search Mode Toggle */}
                <div className="flex justify-center mb-6">
                  <div className="inline-flex rounded-full p-1 bg-gray-100 dark:bg-gray-700 w-full sm:w-auto">
                    <button
                      className={`px-4 py-2 rounded-full text-sm font-medium transition-all w-1/2 sm:w-auto ${searchMode === "image" ? "bg-gradient-to-r from-sky-600 to-rose-600 text-white shadow-md" : "text-gray-600 dark:text-gray-300"}`}
                      onClick={() => setSearchMode("image")}
                    >
                      <i className="fas fa-image mr-2"></i>
                      Image
                    </button>
                    <button
                      className={`px-4 py-2 rounded-full text-sm font-medium transition-all w-1/2 sm:w-auto ${searchMode === "text" ? "bg-gradient-to-r from-sky-600 to-rose-600 text-white shadow-md" : "text-gray-600 dark:text-gray-300"}`}
                      onClick={() => setSearchMode("text")}
                    >
                      <i className="fas fa-search mr-2"></i>
                      Text
                    </button>
                  </div>
                </div>

                {/* Tab Navigation - Only show for image search */}
                {searchMode === "image" && (
                  <div className="flex border-b border-gray-200 dark:border-gray-700 mb-6 mobile-scroll">
                    <button
                      className={`px-4 py-2 font-medium flex items-center gap-2 whitespace-nowrap ${activeTab === "upload" ? "text-sky-600 dark:text-sky-400 border-b-2 border-sky-500" : "text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"}`}
                      onClick={() => setActiveTab("upload")}
                    >
                      <i className="fas fa-upload"></i>
                      Upload Image
                    </button>
                    <button
                      className={`px-4 py-2 font-medium flex items-center gap-2 whitespace-nowrap ${activeTab === "url" ? "text-sky-600 dark:text-sky-400 border-b-2 border-sky-500" : "text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"}`}
                      onClick={() => setActiveTab("url")}
                    >
                      <i className="fas fa-link"></i>
                      Image URL
                    </button>
                  </div>
                )}

                <div className="grid gap-8 md:grid-cols-2">
                  {/* Inputs */}
                  <div className="grid gap-6">
                    {searchMode === "image" ? (
                      activeTab === "upload" ? (
                        <div className="grid gap-3">
                          <label className="text-sm font-semibold text-sky-700 dark:text-sky-300 flex items-center gap-2">
                            <i className="fas fa-cloud-upload-alt"></i>
                            Upload image
                          </label>
                          <div className="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-2xl p-4 sm:p-6 text-center transition-colors hover:border-sky-400 dark:hover:border-sky-500">
                            <input
                              type="file"
                              accept="image/*"
                              onChange={onPick}
                              className="absolute opacity-0 w-full h-full cursor-pointer"
                              id="file-upload"
                            />
                            <div className="flex flex-col items-center justify-center gap-3">
                              <div className="p-3 bg-sky-100 dark:bg-sky-900/30 rounded-full">
                                <i className="fas fa-file-image text-sky-500 text-xl"></i>
                              </div>
                              <div>
                                <p className="font-medium text-gray-700 dark:text-gray-200 text-sm sm:text-base">
                                  Drop your image here or click to browse
                                </p>
                                <p className="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                  Supports JPG, PNG, WebP (Max 5MB)
                                </p>
                              </div>
                              {file && (
                                <span className="inline-block mt-2 px-3 py-1 bg-sky-100 text-sky-700 dark:bg-sky-900/30 dark:text-sky-300 rounded-full text-xs sm:text-sm">
                                  <i className="fas fa-check-circle mr-1"></i>
                                  {file.name}
                                </span>
                              )}
                            </div>
                          </div>
                        </div>
                      ) : (
                        <div className="grid gap-3">
                          <label className="text-sm font-semibold text-sky-700 dark:text-sky-300 flex items-center gap-2">
                            <i className="fas fa-link"></i>
                            Image URL
                          </label>
                          <div className="flex gap-2">
                            <div className="flex-1 relative">
                              <input
                                className="w-full border rounded-2xl px-4 py-3 bg-white/70 dark:bg-gray-700 dark:border-gray-600 pl-10 focus:ring-2 focus:ring-sky-500 focus:border-transparent"
                                placeholder="Paste image URL here"
                                value={imageUrl}
                                onChange={(e) => onUrlChange(e.target.value)}
                              />
                              <i className="fas fa-link absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                            </div>
                          </div>
                        </div>
                      )
                    ) : (
                      <div className="grid gap-3">
                        <label className="text-sm font-semibold text-sky-700 dark:text-sky-300 flex items-center gap-2">
                          <i className="fas fa-search"></i>
                          Search Query
                        </label>
                        <div className="flex gap-2">
                          <div className="flex-1 relative">
                            <input
                              className="w-full border rounded-2xl px-4 py-3 bg-white/70 dark:bg-gray-700 dark:border-gray-600 pl-10 focus:ring-2 focus:ring-sky-500 focus:border-transparent"
                              placeholder="Describe what you're looking for..."
                              value={searchQuery}
                              onChange={(e) => setSearchQuery(e.target.value)}
                            />
                            <i className="fas fa-keyboard absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                          </div>
                        </div>
                      </div>
                    )}

                    <div className="grid gap-4">
                      <div>
                        <label className="text-sm font-semibold text-amber-700 dark:text-amber-300 flex items-center gap-2 mb-2">
                          <i className="fas fa-sliders-h"></i>
                          Similarity Threshold
                        </label>
                        <div className="flex items-center gap-3">
                          <div className="relative flex-1">
                            <input
                              type="number"
                              min="0"
                              max="1"
                              step="0.01"
                              value={minScore}
                              onChange={handleThresholdChange}
                              className="w-full border rounded-2xl px-4 py-3 bg-white/70 dark:bg-gray-700 dark:border-gray-600 pr-10 focus:ring-2 focus:ring-sky-500 focus:border-transparent"
                              placeholder="0.00 - 1.00"
                            />
                            <div className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400">
                              <i className="fas fa-percent"></i>
                            </div>
                          </div>
                        </div>
                        <div className="flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-1">
                          <span>0 (Low)</span>
                          <span>1 (High)</span>
                        </div>
                      </div>

                      <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                          <label className="text-sm font-semibold text-sky-700 dark:text-sky-300 mb-2 block">
                            Results per page
                          </label>
                          <div 
                            className="relative"
                            onClick={(e) => e.stopPropagation()}
                          >
                            <select
                              className="w-full border rounded-xl px-3 py-2 bg-white/70 dark:bg-gray-700 dark:border-gray-600 appearance-none focus:ring-2 focus:ring-sky-500 focus:border-transparent"
                              value={perPage}
                              onChange={(e) => setPerPage(Number(e.target.value))}
                            >
                              {[6, 12, 24].map((n) => (
                                <option key={n} value={n}>
                                  {n}
                                </option>
                              ))}
                            </select>
                            <i className="fas fa-chevron-down absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                          </div>
                        </div>
                        <div>
                          <label className="text-sm font-semibold text-rose-700 dark:text-rose-300 mb-2 block">
                            Sort by
                          </label>
                          <div 
                            className="relative"
                            onClick={(e) => e.stopPropagation()}
                          >
                            <select
                              className="w-full border rounded-xl px-3 py-2 bg-white/70 dark:bg-gray-700 dark:border-gray-600 appearance-none focus:ring-2 focus:ring-sky-500 focus:border-transparent"
                              value={sort}
                              onChange={(e) => setSort(e.target.value)}
                            >
                              <option value="score_desc">Highest Score</option>
                              <option value="score_asc">Lowest Score</option>
                            </select>
                            <i className="fas fa-sort absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div className="flex gap-3 flex-col sm:flex-row">
                      <button
                        onClick={() => setShowFilters(!showFilters)}
                        className="flex-1 px-4 py-3 rounded-2xl glass-effect hover:bg-white/20 transition-all duration-300 flex items-center justify-center gap-2 mobile-tap-target"
                      >
                        <i className={`fas ${showFilters ? 'fa-filter-circle-dollar' : 'fa-filter'}`}></i>
                        {showFilters ? 'Hide Filters' : 'Show Filters'}
                      </button>
                      <button
                        onClick={onSearch}
                        disabled={loading || (searchMode === "image" ? !file && !imageUrl : !searchQuery.trim())}
                        className="flex-1 shine-effect px-6 py-3 rounded-2xl bg-gradient-to-r from-sky-600 to-rose-600 text-white font-medium shadow-lg hover:shadow-xl transition-all duration-300 disabled:opacity-50 flex items-center justify-center gap-2 mobile-tap-target mobile-text-lg"
                      >
                        {loading ? (
                          <>
                            <i className="fas fa-spinner fa-spin"></i>
                            Searching...
                          </>
                        ) : (
                          <>
                            <i className="fas fa-search"></i>
                            Find Products
                          </>
                        )}
                      </button>
                    </div>

                    {err && (
                      <div className="text-sm text-rose-800 bg-rose-50 border border-rose-200 p-3 rounded-xl dark:bg-rose-900/40 dark:text-rose-200 flex items-start gap-3">
                        <i className="fas fa-exclamation-circle text-rose-500 mt-0.5"></i>
                        <div>{err}</div>
                      </div>
                    )}

                    {/* Advanced Filters */}
                    {showFilters && (
                      <div className="mt-4 p-4 rounded-2xl glass-effect border border-white/20">
                        <div className="flex items-center justify-between mb-4">
                          <h3 className="font-semibold text-sky-700 dark:text-sky-300">
                            <i className="fas fa-filter mr-2"></i>
                            Advanced Filters
                          </h3>
                          <button 
                            onClick={clearFilters}
                            className="text-xs text-rose-600 dark:text-rose-400 hover:underline"
                          >
                            Clear All
                          </button>
                        </div>
                        
                        <div className="grid gap-4">
                          {/* Price Range Filter */}
                          <div>
                            <label className="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block">
                              Price Range: ${priceRange[0]} - ${priceRange[1]}
                            </label>
                            <div 
                              className="px-2"
                              onClick={(e) => e.stopPropagation()}
                            >
                              <input
                                type="range"
                                min="0"
                                max="200"
                                value={priceRange[0]}
                                onChange={(e) => handlePriceChange(e, 0)}
                                className="w-full mb-2"
                              />
                              <input
                                type="range"
                                min="0"
                                max="200"
                                value={priceRange[1]}
                                onChange={(e) => handlePriceChange(e, 1)}
                                className="w-full"
                              />
                            </div>
                          </div>
                          
                          {/* Category Filter */}
                          <div>
                            <label className="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block">
                              Categories
                            </label>
                            <div className="grid grid-cols-2 gap-2">
                              {categories.map(category => (
                                <label key={category} className="flex items-center text-sm">
                                  <input
                                    type="checkbox"
                                    checked={selectedCategories.includes(category)}
                                    onChange={() => toggleCategory(category)}
                                    className="filter-checkbox h-4 w-4 rounded border-gray-300 text-sky-600 focus:ring-sky-500 mr-2"
                                  />
                                  {category}
                                </label>
                              ))}
                            </div>
                          </div>
                          
                          {/* Brand Filter */}
                          <div>
                            <label className="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block">
                              Brands
                            </label>
                            <div className="grid grid-cols-2 gap-2">
                              {brands.map(brand => (
                                <label key={brand} className="flex items-center text-sm">
                                  <input
                                    type="checkbox"
                                    checked={selectedBrands.includes(brand)}
                                    onChange={() => toggleBrand(brand)}
                                    className="filter-checkbox h-4 w-4 rounded border-gray-300 text-sky-600 focus:ring-sky-500 mr-2"
                                  />
                                  {brand}
                                </label>
                              ))}
                            </div>
                          </div>
                        </div>
                      </div>
                    )}
                  </div>

                  {/* Preview - Only show for image search */}
                  {searchMode === "image" && (
                    <div className="grid gap-3">
                      <label className="text-sm font-semibold text-rose-700 dark:text-rose-300 flex items-center gap-2">
                        <i className="fas fa-image"></i>
                        Preview
                      </label>
                      <div 
                        className="group aspect-square rounded-2xl border-2 border-dashed border-gray-300 dark:border-gray-600 bg-white/60 dark:bg-gray-700 overflow-hidden grid place-items-center relative transition-colors hover:border-sky-400 dark:hover:border-sky-500 cursor-pointer"
                        onClick={() => preview && setShowImageModal(true)}
                      >
                        {preview ? (
                          <>
                            <img
                              src={preview}
                              alt="Query preview"
                              className="w-full h-full object-cover transition-transform duration-500 group-hover:scale-[1.03]"
                            />
                            <div className="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                              <span className="text-white font-medium text-sm">
                                <i className="fas fa-search-plus mr-2"></i>
                                Click to enlarge
                              </span>
                            </div>
                          </>
                        ) : (
                          <div className="text-center p-6">
                            <i className="fas fa-image text-gray-400 text-4xl mb-3"></i>
                            <p className="text-xs text-gray-500 dark:text-gray-400">
                              No image selected
                            </p>
                          </div>
                        )}
                      </div>

                      {/* Examples */}
                      <div className="mt-4">
                        <label className="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2 block">
                          Try example images:
                        </label>
                        <div className="grid grid-cols-2 gap-2">
                          {[
                            "https://images.unsplash.com/photo-1512436991641-6745cdb1723f",
                            "https://images.unsplash.com/photo-1542291026-7eec264c27ff",
                            "https://images.unsplash.com/photo-1517841905240-472988babdf9",
                            "https://images.unsplash.com/photo-1528701800489-20be3c2ea5a2",
                          ].map((u, i) => (
                            <button
                              key={i}
                              onClick={() => useExample(u)}
                              className="group relative aspect-square rounded-xl overflow-hidden border border-gray-200 dark:border-gray-700 hover:border-sky-400 dark:hover:border-sky-500 transition-all mobile-tap-target"
                            >
                              <img
                                src={u + "?auto=format&fit=crop&w=150&q=60"}
                                alt={`Example ${i + 1}`}
                                className="w-full h-full object-cover"
                              />
                              <div className="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                                <span className="text-white text-xs font-medium">
                                  Example {i + 1}
                                </span>
                              </div>
                            </button>
                          ))}
                        </div>
                      </div>
                    </div>
                  )}
                </div>
              </div>
            </section>

            {/* Results */}
            <section>
              {loading ? (
                <div className="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4 sm:gap-6">
                  {Array.from({ length: 8 }).map((_, i) => (
                    <div
                      key={i}
                      className="border rounded-2xl overflow-hidden bg-white/70 dark:bg-gray-700 dark:border-gray-600 animate-pulse product-card"
                    >
                      <div className="aspect-square bg-gradient-to-r from-gray-100 via-gray-200 to-gray-100 dark:from-gray-600 dark:via-gray-700 dark:to-gray-600" />
                      <div className="p-3 sm:p-4 space-y-3">
                        <div className="h-4 bg-gray-200 dark:bg-gray-600 rounded" />
                        <div className="h-3 bg-gray-200 dark:bg-gray-600 rounded w-3/4" />
                        <div className="h-3 bg-gray-200 dark:bg-gray-600 rounded w-1/2" />
                      </div>
                    </div>
                  ))}
                </div>
              ) : pageItems.length ? (
                <>
                  <div className="flex items-center justify-between mb-6 flex-col sm:flex-row gap-4 sm:gap-0">
                    <h3 className="text-xl font-bold text-gray-800 dark:text-gray-200">
                      {total} Matching Products
                    </h3>
                    <div className="text-sm text-gray-600 dark:text-gray-400 flex items-center gap-2 flex-wrap justify-center">
                      <i className="fas fa-filter"></i>
                      Showing {Math.min(perPage, total)} of {total} products
                      <span className="px-2 py-1 bg-sky-100 text-sky-700 dark:bg-sky-900/30 dark:text-sky-300 rounded-full">
                        Threshold: â‰¥{minScore.toFixed(2)}
                      </span>
                    </div>
                  </div>
                  
                  <div className="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4 sm:gap-6">
                    {pageItems.map((item) => (
                      <article
                        key={item.id}
                        className="group border rounded-2xl overflow-hidden bg-white/90 dark:bg-gray-800 dark:border-gray-700 shadow-md hover:shadow-xl transition-all duration-300 product-card"
                      >
                        <div className="overflow-hidden relative">
                          <img
                            src={item.image_url}
                            alt={item.name}
                            className="w-full aspect-square object-cover transition-transform duration-500 group-hover:scale-[1.05]"
                            loading="lazy"
                          />
                          <div className="absolute top-3 right-3">
                            <span className="inline-flex items-center rounded-full bg-amber-100 px-2.5 py-0.5 text-xs font-medium text-amber-800 dark:bg-amber-900/40 dark:text-amber-200">
                              <i className="fas fa-star mr-1 text-amber-500"></i>
                              {Number(item.score).toFixed(2)}
                            </span>
                          </div>
                          <div className="absolute top-3 left-3">
                            <span className="inline-flex items-center rounded-full bg-sky-100 px-2.5 py-0.5 text-xs font-medium text-sky-800 dark:bg-sky-900/40 dark:text-sky-200">
                              {item.brand}
                            </span>
                          </div>
                        </div>
                        <div className="p-3 sm:p-4">
                          <div className="text-sm font-semibold text-gray-800 dark:text-gray-200 line-clamp-1 mb-1">
                            {item.name}
                          </div>
                          <div className="text-xs text-gray-600 dark:text-gray-400 mb-2 flex items-center gap-2">
                            <i className="fas fa-tag"></i>
                            {item.category}
                          </div>
                          <div className="flex items-center justify-between mt-3">
                            <span className="font-bold text-rose-600 dark:text-rose-400 text-sm sm:text-base">
                              {item.price}
                            </span>
                            <button className="text-xs bg-sky-100 text-sky-700 dark:bg-sky-900/30 dark:text-sky-300 hover:bg-sky-200 dark:hover:bg-sky-800 px-2 py-1 rounded-full transition-colors mobile-tap-target">
                              <i className="fas fa-shopping-cart mr-1"></i>
                              Buy
                            </button>
                          </div>
                        </div>
                      </article>
                    ))}
                  </div>

                  <div className="mt-8 flex items-center justify-center gap-4 flex-wrap">
                    <button
                      className="px-4 py-2 rounded-full glass-effect hover:bg-white/20 transition-all duration-300 disabled:opacity-50 flex items-center gap-2 mobile-tap-target"
                      onClick={() => setPage((p) => Math.max(1, p - 1))}
                      disabled={page === 1}
                    >
                      <i className="fas fa-chevron-left"></i>
                      Previous
                    </button>
                    <span className="text-sm px-4 py-2 rounded-full glass-effect">
                      Page {page} of {totalPages}
                    </span>
                    <button
                      className="px-4 py-2 rounded-full glass-effect hover:bg-white/20 transition-all duration-300 disabled:opacity-50 flex items-center gap-2 mobile-tap-target"
                      onClick={() => setPage((p) => Math.min(totalPages, p + 1))}
                      disabled={page === totalPages}
                    >
                      Next
                      <i className="fas fa-chevron-right"></i>
                    </button>
                  </div>
                </>
              ) : (
                <div className="text-center py-16 px-6 bg-white/80 dark:bg-gray-800 border rounded-3xl dark:border-gray-700">
                  <i className="fas fa-search text-4xl text-gray-400 mb-4"></i>
                  <h3 className="text-xl font-medium text-gray-700 dark:text-gray-300 mb-2">
                    No products match your search
                  </h3>
                  <p className="text-gray-500 dark:text-gray-400 max-w-md mx-auto">
                    No matches found above {minScore.toFixed(2)} similarity score. 
                    Try lowering the threshold or using a different image.
                  </p>
                  <button 
                    onClick={() => setMinScore(0.3)}
                    className="mt-4 px-4 py-2 bg-gradient-to-r from-sky-600 to-rose-600 text-white rounded-full text-sm font-medium mobile-tap-target"
                  >
                    Try Lower Threshold (0.3)
                  </button>
                </div>
              )}
            </section>
          </main>

          <footer className="py-12 mt-12 text-center">
            <div className="max-w-7xl mx-auto px-4">
              <div className="inline-flex flex-col sm:flex-row items-center gap-4 px-6 py-3 rounded-full glass-effect">
                <span className="flex items-center gap-2">
                  <i className="fas fa-heart text-rose-500"></i>
                  Â© 2025 StyleSense â€¢ Vercel + FastAPI
                </span>
                <div className="hidden sm:block w-px h-6 bg-gray-300 dark:bg-gray-600"></div>
                <div className="flex items-center gap-4">
                  <a href="#" className="text-gray-600 dark:text-gray-400 hover:text-sky-600 dark:hover:text-sky-400 transition-colors mobile-tap-target">
                    <i className="fab fa-twitter"></i>
                  </a>
                  <a href="#" className="text-gray-600 dark:text-gray-400 hover:text-sky-600 dark:hover:text-sky-400 transition-colors mobile-tap-target">
                    <i className="fab fa-github"></i>
                  </a>
                  <a href="#" className="text-gray-600 dark:text-gray-400 hover:text-sky-600 dark:hover:text-sky-400 transition-colors mobile-tap-target">
                    <i className="fab fa-linkedin"></i>
                  </a>
                </div>
              </div>
            </div>
          </footer>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>